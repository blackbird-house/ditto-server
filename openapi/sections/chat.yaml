paths:
  /chats:
    post:
      summary: Create a new chat
      description: Creates a new 1-to-1 chat between the authenticated user and another user
      operationId: createChat
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
              properties:
                userId:
                  type: string
                  description: ID of the user to start a chat with
                  example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '201':
          description: Chat created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    example: "123e4567-e89b-12d3-a456-426614174000"
                  user1Id:
                    type: string
                    example: "123e4567-e89b-12d3-a456-426614174000"
                  user2Id:
                    type: string
                    example: "987fcdeb-51a2-43d1-b456-426614174000"
                  createdAt:
                    type: string
                    format: date-time
                    example: "2025-09-14T16:32:26.000Z"
        '400':
          description: Bad Request - Invalid data
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Bad Request"
                  message:
                    type: string
                    example: "Invalid request data"
        '401':
          description: Unauthorized - Invalid or missing authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Unauthorized"
                  message:
                    type: string
                    example: "Authentication required"
        '404':
          description: Not Found - User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Not Found"
                  message:
                    type: string
                    example: "Participant not found"
        '500':
          description: Internal Server Error - Unexpected server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Internal Server Error"
                  message:
                    type: string
                    example: "Failed to create chat"
      tags:
        - Chat

    get:
      summary: Get user's chats
      description: Retrieves all chats for the authenticated user
      operationId: getUserChats
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Chats retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      example: "123e4567-e89b-12d3-a456-426614174000"
                    user1Id:
                      type: string
                      example: "123e4567-e89b-12d3-a456-426614174000"
                    user2Id:
                      type: string
                      example: "987fcdeb-51a2-43d1-b456-426614174000"
                    otherUser:
                      type: object
                      properties:
                        id:
                          type: string
                          example: "987fcdeb-51a2-43d1-b456-426614174000"
                        firstName:
                          type: string
                          example: "Jane"
                        lastName:
                          type: string
                          example: "Smith"
                    lastMessage:
                      type: object
                      properties:
                        id:
                          type: string
                          example: "456e7890-e89b-12d3-a456-426614174000"
                        content:
                          type: string
                          example: "Hello, how are you?"
                        senderId:
                          type: string
                          example: "123e4567-e89b-12d3-a456-426614174000"
                        createdAt:
                          type: string
                          format: date-time
                          example: "2025-09-14T16:32:26.000Z"
                    createdAt:
                      type: string
                      format: date-time
                      example: "2025-09-14T16:32:26.000Z"
        '401':
          description: Unauthorized - Invalid or missing authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Unauthorized"
                  message:
                    type: string
                    example: "Authentication required"
        '404':
          description: Not Found - User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Not Found"
                  message:
                    type: string
                    example: "User not found"
        '500':
          description: Internal Server Error - Unexpected server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Internal Server Error"
                  message:
                    type: string
                    example: "Failed to retrieve chats"
      tags:
        - Chat

  /chats/{chatId}:
    get:
      summary: Get chat by ID
      description: Retrieves a specific chat with all its messages (only if user is a user in the chat)
      operationId: getChatById
      security:
        - bearerAuth: []
      parameters:
        - name: chatId
          in: path
          required: true
          description: ID of the chat to retrieve
          schema:
            type: string
            example: "123e4567-e89b-12d3-a456-426614174000"
      responses:
        '200':
          description: Chat retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    example: "123e4567-e89b-12d3-a456-426614174000"
                  user1Id:
                    type: string
                    example: "123e4567-e89b-12d3-a456-426614174000"
                  user2Id:
                    type: string
                    example: "987fcdeb-51a2-43d1-b456-426614174000"
                  otherUser:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "987fcdeb-51a2-43d1-b456-426614174000"
                      firstName:
                        type: string
                        example: "Jane"
                      lastName:
                        type: string
                        example: "Smith"
                  messages:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: "456e7890-e89b-12d3-a456-426614174000"
                        chatId:
                          type: string
                          example: "123e4567-e89b-12d3-a456-426614174000"
                        senderId:
                          type: string
                          example: "123e4567-e89b-12d3-a456-426614174000"
                        content:
                          type: string
                          example: "Hello, how are you?"
                        createdAt:
                          type: string
                          format: date-time
                          example: "2025-09-14T16:32:26.000Z"
                  createdAt:
                    type: string
                    format: date-time
                    example: "2025-09-14T16:32:26.000Z"
        '400':
          description: Bad Request - Invalid chat ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Bad Request"
                  message:
                    type: string
                    example: "Invalid request data"
        '401':
          description: Unauthorized - Invalid or missing authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Unauthorized"
                  message:
                    type: string
                    example: "Authentication required"
        '403':
          description: Forbidden - User is not a user in this chat
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Forbidden"
                  message:
                    type: string
                    example: "Access denied: You can only view your own chats"
        '404':
          description: Not Found - Chat or user not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Not Found"
                  message:
                    type: string
                    example: "Chat not found"
        '500':
          description: Internal Server Error - Unexpected server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Internal Server Error"
                  message:
                    type: string
                    example: "Failed to retrieve chat"
      tags:
        - Chat

  /chats/{chatId}/messages:
    post:
      summary: Send a message
      description: Sends a message to a specific chat (only if user is a user in the chat)
      operationId: sendMessage
      security:
        - bearerAuth: []
      parameters:
        - name: chatId
          in: path
          required: true
          description: ID of the chat to send message to
          schema:
            type: string
            example: "123e4567-e89b-12d3-a456-426614174000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  description: Message content
                  example: "Hello, how are you?"
                  maxLength: 1000
      responses:
        '201':
          description: Message sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    example: "456e7890-e89b-12d3-a456-426614174000"
                  chatId:
                    type: string
                    example: "123e4567-e89b-12d3-a456-426614174000"
                  senderId:
                    type: string
                    example: "123e4567-e89b-12d3-a456-426614174000"
                  content:
                    type: string
                    example: "Hello, how are you?"
                  createdAt:
                    type: string
                    format: date-time
                    example: "2025-09-14T16:32:26.000Z"
        '400':
          description: Bad Request - Invalid data
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Bad Request"
                  message:
                    type: string
                    example: "Invalid request data"
        '401':
          description: Unauthorized - Invalid or missing authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Unauthorized"
                  message:
                    type: string
                    example: "Authentication required"
        '403':
          description: Forbidden - User is not a user in this chat
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Forbidden"
                  message:
                    type: string
                    example: "Access denied: You can only send messages to your own chats"
        '404':
          description: Not Found - Chat or user not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Not Found"
                  message:
                    type: string
                    example: "Chat not found"
        '500':
          description: Internal Server Error - Unexpected server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Internal Server Error"
                  message:
                    type: string
                    example: "Failed to send message"
      tags:
        - Chat

    get:
      summary: Get chat messages
      description: Retrieves messages from a specific chat with pagination (only if user is a user in the chat). Messages are ordered by creation date, most recent first.
      operationId: getChatMessages
      security:
        - bearerAuth: []
      parameters:
        - name: chatId
          in: path
          required: true
          description: ID of the chat to get messages from
          schema:
            type: string
            example: "123e4567-e89b-12d3-a456-426614174000"
        - name: limit
          in: query
          required: false
          description: Maximum number of messages to return (1-20, default 20)
          schema:
            type: integer
            minimum: 1
            maximum: 20
            default: 20
            example: 20
        - name: offset
          in: query
          required: false
          description: Number of messages to skip (default 0)
          schema:
            type: integer
            minimum: 0
            default: 0
            example: 0
      responses:
        '200':
          description: Messages retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      example: "456e7890-e89b-12d3-a456-426614174000"
                    senderId:
                      type: string
                      example: "123e4567-e89b-12d3-a456-426614174000"
                    content:
                      type: string
                      example: "Hello, how are you?"
                    createdAt:
                      type: string
                      format: date-time
                      example: "2025-09-14T16:32:26.000Z"
        '400':
          description: Bad Request - Invalid chat ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Bad Request"
                  message:
                    type: string
                    example: "Invalid request data"
        '401':
          description: Unauthorized - Invalid or missing authentication token
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Unauthorized"
                  message:
                    type: string
                    example: "Authentication required"
        '403':
          description: Forbidden - User is not a user in this chat
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Forbidden"
                  message:
                    type: string
                    example: "Access denied: You can only view messages from your own chats"
        '404':
          description: Not Found - Chat or user not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Not Found"
                  message:
                    type: string
                    example: "Chat not found"
        '500':
          description: Internal Server Error - Unexpected server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Internal Server Error"
                  message:
                    type: string
                    example: "Failed to retrieve messages"
      tags:
        - Chat
